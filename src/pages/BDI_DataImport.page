<apex:page controller="BDI_DataImport_CTRL" title="Batch Data Import" tabStyle="DataImport__c" showHeader="true" sidebar="false" >
    <apex:includeScript value="{!URLFOR($Resource.CumulusStaticResources, '/jquery/jquery-1.10.2.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.CumulusStaticResources, '/Bootstrap/js/bootstrap.min.js')}" />
    <apex:styleSheet value="{!URLFOR($Resource.CumulusStaticResources, '/Bootstrap/css/bootstrap-namespaced.css')}" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

<script type="text/javascript">
    var j$ = jQuery.noConflict();

    function refreshPage(){location.reload(true);}
    
    j$(document).ready(function(){
        j$("#convertBTN").bind("click",function(){
            //hide buttons
            j$("#conversionBTN").hide();
            //hide panels
            j$(".panel").hide();
            //render outputpanel
            //j$("#progresspanel").removeClass('hide');
            //call conversion
            callConversion();
        });
    });

    function callConversion(){
        runconvert() ;
    }

    function renderResults(){
            j$("#progresspanel").removeClass('hide');
        j$("div[class^='message']").hide();
    }

    

</script>

<style>
    body{
        margin:0px;
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    }
    .bootstrap3 h1, .bootstrap3 h2, .bootstrap3 h3, .bootstrap3 h4{ 
        font-family: Vagrolight,Arial,Helvetica,sans-serif;
    }
    .bootstrap3 p{
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    }
    .bootstrap .jumbotron{
        background-color: #f0f1f2;
        margin-bottom:0px;
    }
    .bootstrap .container .jumbotron {
        padding: 20px;
    }
    .bootstrap .container {
        padding-top: 10px;
    }
    /* Customize container */
    @media (min-width: 768px) {}
    .bootstrap .panel .list-group .list-group-item {
        border-width: 0;
        padding: 5px 0px 5px 0px;
    }
    ul.err li {
        list-style-type: none;
        color: #cc0000;
        font-weight: bold; 
    }
    label {
        display: block;
    }
    .bootstrap input{
        top: -1px;
    }
    .bootstrap input[type="checkbox"]{
        margin-right:10px;
    }
</style>

<apex:pageMessages />
    <div class="bootstrap" >
        <apex:form >
        <!-- HEADER -->
        <div class="container">
            <div class="jumbotron">
                <div class="row">
                    <div class="col-sm-8 col-xs-12" >
                        <h3>Batch Data Import</h3>
                        <h4>This utility allows you to easily import your data into the Nonprofit Starter Pack.</h4>
                    </div>
                    <div class="col-sm-4 col-xs-12" >
                        <img src="{!URLFOR($Resource.CumulusStaticResources, '/Images/NPSP_Logo_Small.png')}" class="img-rounded img-responsive" />
                    </div>
                </div>
            </div>
        </div>

        <div class="container" >
            <div class="row">
                <div class="col-md-6">
                    <div class="panel panel-default">
                        <!-- Default panel contents -->
                        <div class="panel-heading"><h3 class="panel-title">Important Information</h3></div>
                        <div class="panel-body">
                        <p>blah</p>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="panel panel-default">
                        <!-- Default panel contents -->
                        <div class="panel-heading"><h3 class="panel-title">What This Utility Does</h3></div>
                        <div class="panel-body">
                            <p>This utility imports data. duh!</p>
                            <p>Any errors during the import will result in one or more failed batches of Data Import records while other batches may succeed.</p>
                            <p>The following actions are taken by the batch job associated with this tool:</p>
                            <ul>
                                <li>step 1</li>
                                <li>step 2</li>
                                <li>step N</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container" >
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-default">
                        <!-- Default panel contents -->
                        <div class="panel-heading"><h3 class="panel-title">Configuration Options</h3></div>
                        <div class="panel-body">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <apex:outputpanel rendered="{!NOT(ISNULL(apexjob))}" layout="block" id="resultspanelwrapper">
            <div class="container hide" id="resultspanel">
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel {!IF(apexjob.NumberOfErrors > 0 && apexjob.Status == 'Failed', 'panel-warning', 'panel-success')}" id="resultpaneldefault">
                            <div class="panel-heading"><h3 class="panel-title">{!apexjob.Status}: {!IF(apexjob.NumberOfErrors > 0 && apexjob.Status == 'Completed', 'WARNING! Some batches may have failed.  Your data is in an inconsistent state', 'SUCCESS!')}</h3></div>
                            <div class="panel-body">
                                 Completed on {!apexjob.CompletedDate}<br/>
                                 {!apexjob.TotalJobItems} of {!apexjob.JobItemsProcessed} batches were processed<br/>
                                 {!IF(apexjob.NumberOfErrors > 0, ' ' & TEXT(apexjob.NumberOfErrors) & ' batches were not imported due to errors and have been rolled back to their previous state. You should address these errors, rerun Batch Data Import, then check your data for consistency.', '')}<br/><br/>
                                 {!IF(ISBLANK(apexjob.ExtendedStatus), '', 'The first error recorded was: ' + apexjob.ExtendedStatus)}<br/> 
                                 <div class="text-center" style="{!IF(apexjob.NumberOfErrors > 0, '', 'display: none;')}"> 
                                    <button type="button" class="btn btn-warning btn-lg" onclick="refreshPage()" id="reloadBTN">
                                        <span class="glyphicon glyphicon-refresh"></span> Reload the Batch Data Import
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </apex:outputpanel>

        <div class="container hide" id="progresspanel">
            <div class="row">
                <apex:actionFunction name="runconvert" action="{!importData}" reRender="resultspanelwrapper, progresspanel" oncomplete="renderResults()"/>
                <apex:outputPanel id="batchpanel">
                    <c:UTIL_JobProgress strBatchComponentLabel="Batch Data Import Progress" cNumberOfJobs="1" />
                </apex:outputPanel>
            </div>
        </div>
    </apex:form>

    <div class="container">
        <div class="text-center"> 
            <button type="button" class="btn btn-success btn-lg" data-toggle="modal" data-target="#basicModal" id="conversionBTN">
                <span class="glyphicon glyphicon-exclamation-sign"></span> Begin Data Import Process
            </button>
        </div>
        <!-------- MODAL  ------>
        <div class="modal fade" id="basicModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title" id="myModalLabel">Warning!</h4>
                    </div>
                    <div class="modal-body">
                        <h5>Salesforce.com and the Salesforce.com Foundation are not responsible for any data or data integrity loss.  Do you still wish to proceed?</h5>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" data-dismiss="modal" id="convertBTN" >Proceed with Conversion</button>
                    </div>
                </div>
            </div>
        </div>
        <!-------- / MODAL  ------>
    </div>
</div><!-- close class bootstrap-->
</apex:page>