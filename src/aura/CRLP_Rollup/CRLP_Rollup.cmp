<aura:component description="CRLP_Rollup" controller="CRLP_RollupUI_SVC">

    <!-- public attributes -->
    <aura:attribute name="labels" type="Map" description="All available labels for the app."/>
    <aura:attribute name="activeRollup" type="Map" description="The active rollup displayed. Only populated from Clone, View and Edit."/>
    <aura:attribute name="mode" type="String" description="The current mode of the component. Options are: view, edit, clone, or create."/>
    <aura:attribute name="isReadOnly" type="Boolean" default="true" description="Determines if fields should be read-only. This only applies to View."/>
    <aura:attribute name="operations" type="List" description="Map of rollup operations, api name to label"/>
    <aura:attribute name="yearlyOperations" type="List" description="List of yearly operation types" access="public" />
    <aura:attribute name="filterGroups" type="Object[]" description="List of available filter groups" access="public"/>

    <!-- private attributes -->
    <aura:attribute name="objectDetails" type="Map" description="Set list of available objects" access="private"/>
    <aura:attribute name="detailObjects" type="List" description="List of detail objects" access="private"/>
    <aura:attribute name="detailFields" type="List" description="Dependent list of detail fields" access="private"/>
    <aura:attribute name="summaryObjects" type="List" description="Dependent list of summary objects" access="private"/>
    <aura:attribute name="summaryFields" type="List" description="Dependent list of summary fields" access="private"/>
    <aura:attribute name="amountFields" type="List" description="Dependent list of amount fields" access="private"/>
    <aura:attribute name="dateFields" type="List" description="Dependent list of date fields" access="private"/>

    <!-- events we handle -->
    <!--tracking activeRollup instead of changeMode because the change of Mode isn't being registered in the sibling-->
    <!--TODO: remove duplicate action -> remove activeRollup, use event in rollupRow-->
    <!--<aura:handler name="change" value="{!v.activeRollup}" action="{!c.changeMode}" />-->
    <!--note: mode is also listening for edit or clone mode changes from parent cmp-->
    <aura:handler name="change" value="{!v.mode}" action="{!c.changeMode}" />
    <aura:handler name="ModeChanged" event="c:CRLP_ModeChanged" action="{!c.onModeChanged}"/>
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>


   <!-- <aura:handler name="change" value="{!v.activeRollup.Detail_Object__r.QualifiedApiName}" action="{!c.changeDetailObject}" />
    <aura:handler name="change" value="{!v.activeRollup.Detail_Field__r.QualifiedApiName}" action="{!c.changeSummaryField}" />
-->
    <!-- markup -->
        Mode: {!v.mode}
    <!--START FORM-->
    <div aria-labelledby="rollupdetail">
        <form class="slds-form--stacked">
            <lightning:layout>
                <lightning:layoutItem size="12" largeDeviceSize="8">
                    <lightning:layout multipleRows="true" verticalAlign="center">
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <lightning:input aura:id="nameInput"
                                             label="{!v.labels.rollupLabel + v.labels.rollupName}"
                                             name="{!v.labels.rollupLabel + v.labels.rollupName}"
                                             value="{!v.activeRollup.MasterLabel}"
                                             required="{! !v.isReadOnly}"
                                             readonly="{!v.isReadOnly}"/>
                        </lightning:layoutItem>
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="12" size="12">
                            <lightning:textarea aura:id="descriptionInput"
                                             label="{!v.labels.description}"
                                             name="{!v.labels.description}"
                                             value="{!v.activeRollup.Description__c}"
                                             readonly="{!v.isReadOnly}"/>
                        </lightning:layoutItem>


                        <c:CRLP_SelectField isReadOnly="{!v.isReadOnly}"
                                            auraId="detailObject"
                                            fieldName="{!v.labels.detailObject}"
                                            entityLabel="{!v.activeRollup.Detail_Object__r.Label}"
                                            apiName="{!v.activeRollup.Detail_Object__r.QualifiedApiName}"
                                            placeholder="Not Yet Selected"
                                            options="{!v.detailObjects}"

                        />
                        <!--
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <aura:if isTrue="{!v.isReadOnly}">
                                <lightning:input aura:id="detailObjectView"
                                                 label="{!v.labels.detailObject}"
                                                 name="{!v.labels.detailObject}"
                                                 value="{!v.activeRollup.Detail_Object__r.Label}"
                                                 readonly="true"/>
                                <aura:set attribute="else">
                                    <lightning:select aura:id="detailObjectSelect"
                                                      label="{!v.labels.detailObject}"
                                                      name="{!v.labels.detailObject}"
                                                      value="{!v.activeRollup.Detail_Object__r.QualifiedApiName}"
                                                      required="true">
                                        <aura:iteration items="{!v.detailObjects}" var="option">
                                            <option value="{!option.name}" text="{!option.label}" selected="{!option.name == v.activeRollup.Detail_Object__r.QualifiedApiName}"/>
                                        </aura:iteration>
                                    </lightning:select>
                                </aura:set>
                            </aura:if>
                        </lightning:layoutItem>
-->
                        <c:CRLP_SelectField isReadOnly="{!v.isReadOnly}"
                                            auraId="detailField"
                                            fieldName="{!v.labels.detailField}"
                                            entityLabel="{!v.activeRollup.Detail_Field__r.Label}"
                                            apiName="{!v.activeRollup.Detail_Field__r.QualifiedApiName}"
                                            placeholder="{!v.labels.na}"
                                            options="{!v.detailFields}"
                                            hasNullOption="true"

                        />
                        <!--<lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <aura:if isTrue="{!v.isReadOnly}">
                                <lightning:input aura:id="detailFieldView"
                                                 label="{!v.labels.detailField}"
                                                 name="{!v.labels.detailField}"
                                                 value="{!v.activeRollup.Detail_Field__r.Label}"
                                                 readonly="true"
                                                 placeholder="{!v.labels.na}"/>
                                <aura:set attribute="else">
                                    <lightning:select aura:id="detailFieldSelect"
                                                      onchange="{!c.changeSummaryField}"
                                                      label="{!v.labels.detailField}"
                                                      name="{!v.labels.detailField}"
                                                      value="{!v.activeRollup.Detail_Field__r.QualifiedApiName}"
                                                      required="true">
                                        <option value="null" text="{!v.labels.na}" selected="{!null == v.activeRollup.Detail_Field__r.QualifiedApiName}"/>
                                        <aura:iteration items="{!v.detailFields}" var="option">
                                            <option value="{!option.name}" text="{!option.label}" selected="{!option.name == v.activeRollup.Detail_Field__r.QualifiedApiName}"/>
                                        </aura:iteration>
                                    </lightning:select>
                                </aura:set>
                            </aura:if>
                        </lightning:layoutItem>-->
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <aura:if isTrue="{!v.isReadOnly}">
                                <lightning:input aura:id="summaryObjectView"
                                                 label="{!v.labels.summaryObject}"
                                                 name="{!v.labels.summaryObject}"
                                                 value="{!v.activeRollup.Summary_Object__r.Label}"
                                                 readonly="true"/>
                                <aura:set attribute="else">
                                    <lightning:select aura:id="summaryObjectSelect"
                                                      onchange="{!c.changeSummaryField}"
                                                      label="{!v.labels.summaryObject}"
                                                      name="{!v.labels.summaryObject}"
                                                      value="{!v.activeRollup.Summary_Object__r.QualifiedApiName}"
                                                      required="true">
                                        <aura:iteration items="{!v.summaryObjects}" var="option">
                                            <option value="{!option.name}" text="{!option.label}" selected="{!option.name == v.activeRollup.Summary_Object__r.QualifiedApiName}"/>
                                        </aura:iteration>
                                    </lightning:select>
                                </aura:set>
                            </aura:if>

                        </lightning:layoutItem>
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <aura:if isTrue="{!v.isReadOnly}">
                                <lightning:input aura:id="summaryFieldView"
                                                 label="{!v.labels.summaryField}"
                                                 name="{!v.labels.summaryField}"
                                                 value="{!v.activeRollup.Summary_Field__r.Label}"
                                                 readonly="true"/>
                                <aura:set attribute="else">
                                    <lightning:select aura:id="summaryFieldSelect"
                                                      label="{!v.labels.summaryField}"
                                                      name="{!v.labels.summaryField}"
                                                      value="{!v.activeRollup.Summary_Field__r.QualifiedApiName}"
                                                      required="true">
                                        <aura:iteration items="{!v.summaryFields}" var="option">
                                            <option value="{!option.name}" text="{!option.label}" selected="{!option.name == v.activeRollup.Summary_Field__r.QualifiedApiName}"/>
                                        </aura:iteration>
                                    </lightning:select>
                                </aura:set>
                            </aura:if>

                        </lightning:layoutItem>
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <aura:if isTrue="{!v.isReadOnly}">
                                <lightning:input aura:id="filterGroupView"
                                                 label="{!v.labels.filterGroupLabel}"
                                                 value="{!v.activeRollup.Filter_Group__r.MasterLabel}"
                                                 readonly="true"/>
                                <aura:set attribute="else">
                                    <lightning:select aura:id="filterGroupSelect"
                                                      label="{!v.labels.filterGroupLabel}"
                                                      value="{!v.activeRollup.Filter_Group__r.MasterLabel}"
                                                      required="false">
                                        <aura:iteration items="{!v.filterGroups}" var="option">
                                            <option value="{!option.name}" text="{!option.filterGroupName}" selected="{!option.name == v.activeRollup.Filter_Group__r.MasterLabel}"/>
                                        </aura:iteration>
                                    </lightning:select>
                                </aura:set>
                            </aura:if>
                        </lightning:layoutItem>
                    </lightning:layout>


                    <lightning:layout multipleRows="true" verticalAlign="center">

                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="3" size="12">
                            <aura:if isTrue="{!v.isReadOnly}">
                                <lightning:input aura:id="operationView"
                                                 label="{!v.labels.operation}"
                                                 name="{!v.labels.operation}"
                                                 value="{!v.activeRollup.Operation__c}"
                                                 readonly="true"/>
                                <aura:set attribute="else">
                                    <lightning:select aura:id="operationSelect"
                                                      label="{!v.labels.operation}"
                                                      name="{!v.labels.operation}"
                                                      value="{!v.activeRollup.Operation__c}"
                                                      required="true">
                                        <aura:iteration items="{!v.operations}" var="option">
                                            <option value="{!option.name}" text="{!option.label}" selected="{!option.name == v.activeRollup.Operation__c}"/>
                                        </aura:iteration>
                                    </lightning:select>
                                </aura:set>
                            </aura:if>
                        </lightning:layoutItem>
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="3" size="12">
                            <aura:if isTrue="{!v.isReadOnly}">
                                <lightning:input aura:id="yearlyOperationView"
                                                 label="{!v.labels.yearlyOperationType}"
                                                 name="{!v.labels.operation}"
                                                 value="{!v.activeRollup.Yearly_Operation_Type__c}"
                                                 readonly="true"/>
                                <aura:set attribute="else">
                                    <lightning:select aura:id="yearlyOperationSelect"
                                                      label="{!v.labels.yearlyOperationType}"
                                                      name="{!v.labels.operation}"
                                                      value="{!v.activeRollup.Yearly_Operation_Type__c}"
                                                      required="true">
                                        <aura:iteration items="{!v.yearlyOperations}" var="option">
                                            <option value="{!option.name}" text="{!option.label}" selected="{!option.name == v.activeRollup.Yearly_Operation_Type__c}"/>
                                        </aura:iteration>
                                    </lightning:select>
                                </aura:set>
                            </aura:if>
                        </lightning:layoutItem>
                        <lightning:layoutItem padding="around-medium" smallDeviceSize="6" mediumDeviceSize="3" size="12">
                            <!--TODO: add validity checks for numbers-->
                            <!--TODO: verify numbers can be cleared with fixed to W-4540937-->
                            <lightning:input aura:id="integerInput"
                                             label="{!v.labels.integer}"
                                             value="{!v.activeRollup.Integer__c}"
                                             required="false"
                                             readonly="{!v.isReadOnly}"/>
                        </lightning:layoutItem>
                        <lightning:layoutItem padding="around-medium" smallDeviceSize="6" mediumDeviceSize="3" size="12">
                            <aura:if isTrue="{!v.isReadOnly}">
                                <!--todo: how can this be screen-readable?-->
                                <ui:outputCheckbox value="{!v.activeRollup.Use_Fiscal_Year__c}" class="fiscalYearCheckbox"
                                                   altChecked="{!v.labels.useFiscalYear + ' ' + v.labels.checkboxTrue}"
                                                   altUnchecked="{!v.labels.useFiscalYear + ' ' + v.labels.checkboxFalse}"/>
                                <span class="slds-form-element__label fiscalYearCheckbox">{!v.labels.useFiscalYear}</span>
                                <aura:set attribute="else">
                                    <lightning:input aura:id="fiscalYearCheckbox"
                                                     type="checkbox"
                                                     label="{!v.labels.useFiscalYear}"
                                                     value="{!v.activeRollup.Use_Fiscal_Year__c}"
                                                     readonly="{!v.isReadOnly}"/>
                                </aura:set>
                            </aura:if>
                        </lightning:layoutItem>
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <aura:if isTrue="{!v.isReadOnly}">
                                <lightning:input aura:id="amountObjectView"
                                                 label="{!v.labels.amountObject}"
                                                 value="{!v.activeRollup.Amount_Object__r.Label}"
                                                 name="{!v.labels.amountObject}"
                                                 readonly="true"/>
                                <aura:set attribute="else">
                                    <lightning:select aura:id="amountObjectSelect"
                                                      onchange="{!c.changeAmountObject}"
                                                      label="{!v.labels.amountObject}"
                                                      value="{!v.activeRollup.Amount_Object__r.QualifiedApiName}"
                                                      name="{!v.labels.amountObject}">
                                        <aura:iteration items="{!v.detailObjects}" var="option">
                                            <option value="{!option.name}" text="{!option.label}" selected="{!option.name == v.activeRollup.Amount_Object__r.QualifiedApiName}"/>
                                        </aura:iteration>
                                    </lightning:select>
                                </aura:set>
                            </aura:if>
                        </lightning:layoutItem>
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <aura:if isTrue="{!v.isReadOnly}">
                                <lightning:input aura:id="amountFieldView"
                                                  label="{!v.labels.amountField}"
                                                  value="{!v.activeRollup.Amount_Field__r.Label}"
                                                  name="{!v.labels.amountField}"
                                                  readonly="true"/>
                                <aura:set attribute="else">
                                    <lightning:select aura:id="amountFieldSelect"
                                                      label="{!v.labels.amountField}"
                                                      value="{!v.activeRollup.Amount_Field__r.QualifiedApiName}"
                                                      name="{!v.labels.amountField}">
                                        <aura:iteration items="{!v.amountFields}" var="option">
                                            <option value="{!option.name}" text="{!option.label}" selected="{!option.name == v.activeRollup.Amount_Field__r.QualifiedApiName}"/>
                                        </aura:iteration>
                                    </lightning:select>
                                </aura:set>
                            </aura:if>
                        </lightning:layoutItem>
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <aura:if isTrue="{!v.isReadOnly}">
                                <lightning:input aura:id="dateObjectView"
                                                 label="{!v.labels.dateObject}"
                                                 value="{!v.activeRollup.Date_Object__r.Label}"
                                                 name="{!v.labels.dateObject}"
                                                 readonly="true"/>
                                <aura:set attribute="else">
                                    <lightning:select aura:id="dateObjectSelect"
                                                      onchange="{!c.changeDateObject}"
                                                      label="{!v.labels.dateObject}"
                                                      value="{!v.activeRollup.Date_Object__r.QualifiedApiName}"
                                                      name="{!v.labels.dateObject}">
                                        <aura:iteration items="{!v.detailObjects}" var="option">
                                            <option value="{!option.name}" text="{!option.label}" selected="{!option.name == v.activeRollup.Date_Object__r.QualifiedApiName}"/>
                                        </aura:iteration>
                                    </lightning:select>
                                </aura:set>
                            </aura:if>

                        </lightning:layoutItem>
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <aura:if isTrue="{!v.isReadOnly}">
                                <lightning:input aura:id="dateFieldView"
                                                  label="{!v.labels.dateField}"
                                                  value="{!v.activeRollup.Date_Field__r.Label}"
                                                  name="{!v.labels.dateField}"
                                                  readonly="true"/>
                                <aura:set attribute="else">
                                    <lightning:select aura:id="dateFieldSelect"
                                                      label="{!v.labels.dateField}"
                                                      value="{!v.activeRollup.Date_Field__r.QualifiedApiName}"
                                                      name="{!v.labels.dateField}">
                                        <aura:iteration items="{!v.dateFields}" var="option">
                                            <option value="{!option.name}" text="{!option.label}" selected="{!option.name == v.activeRollup.Date_Field__r.QualifiedApiName}"/>
                                        </aura:iteration>
                                    </lightning:select>
                                </aura:set>
                            </aura:if>
                        </lightning:layoutItem>
                    </lightning:layout>
                </lightning:layoutItem>
            </lightning:layout>
        </form>
    </div>

    <!--START FORM BUTTONS-->
    <div>
        <lightning:layout>
            <lightning:layoutItem size="12" largeDeviceSize="8">
                <aura:if isTrue="{!v.mode!='view'}">
                    <div class="slds-p-around--large">
                        <lightning:layout horizontalAlign="center">
                            <!--TODO: this button needs an onclick function to save stuff-->
                            <lightning:button label="{!v.labels.save}" variant="brand"/>
                            <lightning:button label="{!v.labels.cancel}" variant="neutral" onclick="{!c.onCancel}"/>
                        </lightning:layout>
                    </div>
                </aura:if>
            </lightning:layoutItem>
        </lightning:layout>
    </div>
    <!--END BUTTONS-->



    <!-- end markup -->

</aura:component>
