<aura:component description="CRLP_Rollup" controller="CRLP_RollupUI_SVC">

    <!-- public attributes -->
    <aura:attribute name="labels" type="Map" description="All available labels for the app."/>
    <aura:attribute name="activeRollup" type="Map" description="The active rollup displayed. Only populated from Clone, View and Edit."/>
    <aura:attribute name="mode" type="String" default="edit" description="The current mode of the component. Options are: view, edit, clone, or create."/>
    <aura:attribute name="isReadOnly" type="Boolean" default="true" description="Determines if fields should be read-only. This only applies to View."/>
    <!-- private attributes -->
    <aura:attribute name="objectDetails" type="Map" description="Set list of available objects" access="private"/>
    <aura:attribute name="detailObjects" type="List" description="List of detail objects" access="private"/>
    <aura:attribute name="detailFields" type="Map" description="Dependent list of detail fields" access="private"/>
    <aura:attribute name="summaryObjects" type="Map" description="Dependent list of summary objects" access="private"/>
    <aura:attribute name="summaryFields" type="Map" description="Dependent list of summary fields" access="private"/>

    <!-- events we handle -->
    <!--tracking activeRollup instead of changeMode because the change of Mode isn't being registered in the sibling-->
    <!--TODO: remove duplicate action -> remove activeRollup, use event??-->
    <aura:handler name="change" value="{!v.activeRollup}" action="{!c.changeMode}" />
    <aura:handler name="change" value="{!v.mode}" action="{!c.changeMode}" />

    <!-- markup -->

        {!v.activeRollup.Detail_Object__r.QualifiedApiName}
    <br/>{!v.activeRollup.Detail_Field__r.QualifiedApiName}
    <br/>{!v.activeRollup.Summary_Object__r.QualifiedApiName}
    <br/>{!v.activeRollup.Summary_Field__r.QualifiedApiName}


    <div aria-labelledby="rollupdetail">
        <form class="slds-form--stacked">
            <lightning:layout>
                <lightning:layoutItem size="12" largeDeviceSize="8">
                    <div class="slds-p-horizontal--large slds-p-bottom--small">
                        <lightning:layout horizontalAlign="end">
                            <lightning:layoutItem flexibility="auto">
                                <lightning:buttonGroup >
                                    <lightning:button label="{!v.labels.edit}" value="{!v.labels.edit}" onclick="{!c.setModeEdit}"/>
                                    <lightning:button label="{!v.labels.clone}" value="{!v.labels.clone}" onclick="{!c.setModeClone}"/>
                                </lightning:buttonGroup>
                            </lightning:layoutItem>
                        </lightning:layout>
                    </div>
                    <lightning:layout multipleRows="true">
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <lightning:input aura:id="rollupdetail"
                                             label="{!v.labels.rollupLabel + v.labels.rollupName}"
                                             name="{!v.labels.rollupLabel + v.labels.rollupName}"
                                             value="{!v.activeRollup.MasterLabel}"
                                             required="true"
                                             readonly="{!v.isReadOnly}"/>
                        </lightning:layoutItem>
                    </lightning:layout>
                    <lightning:layout multipleRows="true">
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <lightning:select aura:id="detailObjectSelect"
                                              onchange="{!c.changeDetailObject}"
                                              label="{!v.labels.detailObject}"
                                              name="{!v.labels.detailObject}"
                                              required="true"
                                              disabled="{!v.isReadOnly}">
                                            <!-- this doesn't do anything: readonly="true"-->
                                <aura:iteration items="{!v.detailObjects}" var="option">
                                    <option value="{!option.name}" text="{!option.label}" selected="{!option.name == v.activeRollup.Detail_Object__r.QualifiedApiName}"/>
                                </aura:iteration>
                            </lightning:select>
                        </lightning:layoutItem>
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <lightning:select aura:id="detailFieldSelect"
                                              onchange="{!c.changeDetailField}"
                                              label="{!v.labels.detailField}"
                                              name="{!v.labels.detailField}"
                                              value="{!v.activeRollup.Detail_Field__r.QualifiedApiName}"
                                              required="true"
                                              disabled="{!v.isReadOnly}">
                                <option value="null" text="{!v.labels.na}" selected="{!null == v.activeRollup.Detail_Field__r.QualifiedApiName}"/>
                                <aura:iteration items="{!v.detailFields}" var="option">
                                    <option value="{!option.name}" text="{!option.label}" selected="{!option.name == v.activeRollup.Detail_Field__r.QualifiedApiName}"/>
                                </aura:iteration>
                            </lightning:select>
                        </lightning:layoutItem>
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <lightning:select aura:id="summaryObjectSelect"
                                              onchange="{!c.changeSummaryObject}"
                                              label="{!v.labels.summaryObject}"
                                              name="{!v.labels.summaryObject}"
                                              value="{!v.activeRollup.Summary_Object__r.QualifiedApiName}"
                                              required="true"
                                              disabled="{!v.isReadOnly}">
                                <aura:iteration items="{!v.summaryObjects}" var="option">
                                    <option value="{!option.name}" text="{!option.label}" selected="{!option.name == v.activeRollup.Summary_Object__r.QualifiedApiName}"/>
                                </aura:iteration>
                            </lightning:select>
                        </lightning:layoutItem>
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <lightning:select aura:id="summaryFieldSelect"
                                              label="{!v.labels.summaryField}"
                                              name="{!v.labels.summaryField}"
                                              value="{!v.activeRollup.Summary_Field__r.QualifiedApiName}"
                                              required="true"
                                              disabled="{!v.isReadOnly}">
                                <aura:iteration items="{!v.summaryFields}" var="option">
                                    <option value="{!option.name}" text="{!option.label}" selected="{!option.name == v.activeRollup.Summary_Field__r.QualifiedApiName}"/>
                                </aura:iteration>
                            </lightning:select>
                        </lightning:layoutItem>
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <lightning:input aura:id="rollupdetail"
                                             label="{!v.labels.operation}"
                                             value="{!v.activeRollup.Operation__c}"
                                             required="true"
                                             readonly="{!v.isReadOnly}"/>
                        </lightning:layoutItem>
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <!-- Using ui:inputCheckbox here because the boolean/checkbox fx of lightning:input still sucks -->
                            <!-- it looks a little large... not a deal-breaker, but probably can be fixed with some class cleverness. -->
                            <ui:inputCheckbox label="{!v.labels.useFiscalYear}"
                                              value="{!v.activeRollup.Use_Fiscal_Year__c}"
                                              disabled="{!v.isReadOnly}"/>
                        </lightning:layoutItem>
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <lightning:input aura:id="rollupdetail"
                                             label="{!v.labels.yearlyOperationType}"
                                             value="{!v.activeRollup.Yearly_Operation_Type__c}"
                                             required="false"
                                             readonly="{!v.isReadOnly}"/>
                        </lightning:layoutItem>
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <lightning:input aura:id="rollupdetail"
                                             label="{!v.labels.integer}"
                                             value="{!v.activeRollup.Integer__c}"
                                             required="false"
                                             readonly="{!v.isReadOnly}"/>
                        </lightning:layoutItem>
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <lightning:input aura:id="rollupdetail"
                                             label="{!v.labels.filterGroupLabel}"
                                             value="{!v.activeRollup.Filter_Group__r.MasterLabel}"
                                             required="false"
                                             readonly="{!v.isReadOnly}"/>
                        </lightning:layoutItem>
                    </lightning:layout>
                    <lightning:layout multipleRows="true">
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <lightning:input aura:id="rollupdetail"
                                             label="{!v.labels.amountObject}"
                                             value="{!v.activeRollup.Amount_Object__r.QualifiedApiName}"
                                             required="false"
                                             readonly="{!v.isReadOnly}"/>
                        </lightning:layoutItem>
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <lightning:input aura:id="rollupdetail"
                                             label="{!v.labels.amountField}"
                                             value="{!v.activeRollup.Amount_Field__r.QualifiedApiName}"
                                             required="false"
                                             readonly="{!v.isReadOnly}"/>
                        </lightning:layoutItem>
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <lightning:input aura:id="rollupdetail"
                                             label="{!v.labels.dateObject}"
                                             value="{!v.activeRollup.Date_Object__r.QualifiedApiName}"
                                             required="false"
                                             readonly="{!v.isReadOnly}"/>
                        </lightning:layoutItem>
                        <lightning:layoutItem padding="around-medium" mediumDeviceSize="6" size="12">
                            <lightning:input aura:id="rollupdetail"
                                             label="{!v.labels.dateField}"
                                             value="{!v.activeRollup.Date_Field__r.QualifiedApiName}"
                                             required="false"
                                             readonly="{!v.isReadOnly}"/>
                        </lightning:layoutItem>
                    </lightning:layout>
                    <aura:if isTrue="{!or(v.mode == 'edit', v.mode == 'clone')}">
                        <div class="slds-p-around--large">
                            <lightning:layout horizontalAlign="center">
                                <!--TODO: this button needs an onclick function to save stuff-->
                                <lightning:button label="{!v.labels.save}" variant="brand"/>
                                <!--TODO: onclick to set mode back to view-->
                                <lightning:button label="{!v.labels.cancel}" variant="neutral" onclick="{!c.setModeView}"/>
                            </lightning:layout>
                        </div>
                    </aura:if>
                </lightning:layoutItem>
            </lightning:layout>
       </form>
    </div>




    <!-- end markup -->

</aura:component>
